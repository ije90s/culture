# 2021-03-16 개발일지 
1. 게시판, 멤버에 첨부파일 추가
- fK_culture_group 삭제 : 기존에 foreign key 여러개를 걸어 진행하려고 했으나, 
여러 테이블의 PK를 foreign key로 등록할 수 없어 전에 생성한 fk_culture_group을 삭제 처리 
- 자식 테이블 자동 삭제 : fk에 on delete cascade 속성 추가 
기존에는 이 속성을 주지 않아 tb_attach_group, tb_attach를 둘 다 삭제 처리를 했으나, 
tb_attach의 fk_attach에 속성을 추가하여 tb_attach_group 하나만 삭제 처리하다록 수정 
- 첨부파일 생성, 수정은 기존에 처리했던 대로 똑같이 추가함(기준값 : cno, bno, mno)
cno : 문화기록 PK, bno : 게시판 PK, mno : 멤버 PK(문화기록/게시판 처리완료, 멤버 진행중) 
- 자바스크립트 공통 부분을 찾아서 따로 정리중
- 모달창(진행중) : 게시판 모달창 : 댓글, 이미지 원본 불러오기 곁침 
          회원 모달창 : 회원정보 변경, 비밀번호변경, 회원탈퇴, 이미지 원본 불러오기 곁침 
- 회원정보 이미지(진행중) : 첨부파일 <input>을 넣지 말고, 이미지 자체에서 파일 변경 

2. 로그인 
- 엔터키 누르면, 로그인 submit() 처리 완료
- 부트스트랩 .needs-validation을 이용하여 유효성 체크 

3. 회원가입 
- 화면단, 서버단 둘다 유효성 검사 체크(목적 : 이중체크) 
화면단 : 입력란을 blur후에 값이 제대로 입력되는지를 판단 >> invalid면 오류문구(color:red), valid면 유효문구(color:green), 오류문구삭제 
         submit 전에 한번 더 체크
서버단 : Validation 어노테이션을 이용하여 유효성 체크 >> javax.validation, org.hibernate.validator 라이브러리 추가 
        MemberVO : id, pw, pw2(확인용 암호), 이름, 이메일 유효성 관련 어노테이션 추가
        MemberController : MemberVO 유효성 검사가 false면 로그인폼(입력된 항목을 같이 전달), true면 로그인화면으로(BindingResult 이용)
----------------------------------------------------------------------------------------
느낀점 : 예전에는 화면단에는 간단하게 alert, 서버단에서는 <form> 태그를 이용하여 
오류메시지를 전달했는데, 이번에는 다른 방식으로 화면단이나 서버단에 오류메시지가 발생하면, 
자바스크립트 모듈에서 미리 정의된 문구를 <small>태그에 출력하는 방식으로 진행하였다. 
이번 유효성 검사를 하면서 자바스크립트 모듈 부분이 아직 지식이 약하다는 걸 알게 되었고, 
이 부분을 좀 더 공부하여 만들어진 유효성 모듈을 다듬어서 다시 만들고 싶다.(소스 부분에 반복적인 
부분이 많아서 이부분을 손보고 싶다.)
그전에는 MessageSource, Validator를 직접 생성하여 유효성 검사 부분을 배운 적이 있었는데 
이번에는 다른방식으로 어노테이션을 이용하는 방법을 알았다.       
----------------------------------------------------------------------------------------

4. 문화기록 
- 등록, 수정 : 유효성 검사 추가(회원가입 유효성처럼 화면단, 서버단 둘다 처리)
첨부파일을 가져올 때, 파일 경로를 자바스크립트에서 URIencode로 치환해서 처리하려고 했는데, 
잘 되지 않아 서버단에서 파일명 앞부분까지 URI 처리 후에 넘김. 
- 첨부파일 원본 이미지 보기 : 모달창 아닌 animate로 이미지 화면 보여지게 처리
- 리스트, 통계형 : 윗부분에 탭버튼 추가 
- 리스트형 : 검색어 추가 
- 통계형 : 검색어 위치 변경, 월별 더블 클릭 시, 제목에 상세페이지로 넘어가도록 처리    
----------------------------------------------------------------------------------------
오류 : 검색어를 추가하는데 ReflectionException : cri(@Param 변수명) 오류가 발생하였다. 
원래 Criteria에 mno값을 추가하지 않고 Mapper부분에 @Param을 넣어 값을 구분하였는데  
Criteria에 mno를 추가하여 한값으로 통일하여 해결하였다.  

느낀점 : 서버단에서 Valid를 처리할 때, 변수 타입을 잘보고 어노테이션 처리해야 한다. 
처음에는 cdate가 필수값이라서 @NotBlank으로 지정을 하였는데, @NotBlank는 String만 가능했다.
그래서 굳이 Date형일 필요는 없어서 cdate(날짜)는 String으로 바꿔서 @NotBlank로, kind(종류)도 @Digits로
처리하였다. 이 부분은 꼼꼼히 보지 못하는 부분이라서 빼먹지 말고 자세히 봐야겠다.

유효성 체크가 false가 될 때, 첨부파일을 다시 <li>로 보여줘야했는데, 이부분은 URIencode부분을 헤맸다. 
헤매던 이유는 당연히 파일경로를 제대로 읽은 줄 알고 진행을 하였다. 하지만 로그를 찍어보니, 파일경로가 
'\'를 때문에 깨져서 읽지를 못했고, 이 부분은 서버단에서 URIencode를 해서 전달해주는 걸로 처리를 하였다.
이걸 통해 당연시 된다고 생각하지 말고, 일단 먼저 값을 로그로 찍어보고 판단 후에 진행해야겠다.
----------------------------------------------------------------------------------------
5. 게시판 
- 리스트 : 검색, 목록에 댓글수 추가
댓글수 : tb_board에 replycnt 필드 추가 
댓글 등록 +1, 삭제 -1로 업데이트 처리(트랜잭션 추가 : replycnt가 에러나면, 등록/삭제도 처리 안되도록)   
- 등록, 수정 : 유효성 검사 추가 
- 삭제 : fk_reply에 on delete cascade 추가하여 게시판 삭제 시(댓글이 있으면) 자동 삭제  
- 첨부파일 원본 이미지 보기 : 모달창 아닌 animate로 이미지 화면 보여지게 처리
>>(이미지 파일이 아닌 경우는 아직 안함)
- 게시판 종류별로 게시글이 나오도록 처리 
종류 : 공지사항, 자유게시판, 질문&답변, 문화후기 
리스트 uri : /board/list/{kind}, kind는 @pathvariable로 값 받기 
             리스트 항목을 가져올 때, @Param 어노테이션을 이용하여 Criteria, kind 두 값을 받도록 처리
             Model에 kind값 추가 
             화면단에 목록으로 가는 항목들 링크 변경   
등록/수정/삭제 컨트롤단 : uri경로 수정 
번외) 문화기록 리스트 : 다시 @Param 어노테이션을 이용
----------------------------------------------------------------------------------------
느낀점 : 기존에 했던 부분이라서 헤맨 부분은 없으나, 게시판 같은 경우에는 같은 테이블에 종류만 
나뉠 뿐이라서 첨부파일에 이미지 말고 다른 파일도 올릴 수 있는 기능을 추가해야겠다. 
그리고 리스트목록 uri 변경 부분을 처리하면서 @Param으로 두값을 받는 게 성공하여 어제 해결하지 못한
Criteria안에 mno값을 빼고 @Param값으로 받는 걸로 처리하여 해결하였다.
----------------------------------------------------------------------------------------
