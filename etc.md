# 2021-03-16 개발일지 
1. 게시판, 멤버에 첨부파일 추가
- fK_culture_group 삭제 : 기존에 foreign key 여러개를 걸어 진행하려고 했으나, 
여러 테이블의 PK를 foreign key로 등록할 수 없어 전에 생성한 fk_culture_group을 삭제 처리 
- 자식 테이블 자동 삭제 : fk에 on delete cascade 속성 추가 
기존에는 이 속성을 주지 않아 tb_attach_group, tb_attach를 둘 다 삭제 처리를 했으나, 
tb_attach의 fk_attach에 속성을 추가하여 tb_attach_group 하나만 삭제 처리하다록 수정 
- 첨부파일 생성, 수정은 기존에 처리했던 대로 똑같이 추가함(기준값 : cno, bno, mno)
cno : 문화기록 PK, bno : 게시판 PK, mno : 멤버 PK(문화기록/게시판 처리완료, 멤버 진행중) 
- 자바스크립트 공통 부분을 찾아서 따로 정리중
- 모달창(진행중) : 게시판 모달창 : 댓글, 이미지 원본 불러오기 곁침 
          회원 모달창 : 회원정보 변경, 비밀번호변경, 회원탈퇴, 이미지 원본 불러오기 곁침 
- 회원정보 이미지(진행중) : 첨부파일 <input>을 넣지 말고, 이미지 자체에서 파일 변경 

2. 로그인 
- 엔터키 누르면, 로그인 submit() 처리 완료
- 부트스트랩 .needs-validation을 이용하여 유효성 체크 

3. 회원가입 
- 화면단, 서버단 둘다 유효성 검사 체크(목적 : 이중체크) 
화면단 : 입력란을 blur후에 값이 제대로 입력되는지를 판단 >> invalid면 오류문구(color:red), valid면 유효문구(color:green), 오류문구삭제 
         submit 전에 한번 더 체크
서버단 : Validation 어노테이션을 이용하여 유효성 체크 >> javax.validation, org.hibernate.validator 라이브러리 추가 
        MemberVO : id, pw, pw2(확인용 암호), 이름, 이메일 유효성 관련 어노테이션 추가
        MemberController : MemberVO 유효성 검사가 false면 로그인폼(입력된 항목을 같이 전달), true면 로그인화면으로(BindingResult 이용)
느낀점 : 예전에는 화면단에는 간단하게 alert, 서버단에서는 <form> 태그를 이용하여 
오류메시지를 전달했는데, 이번에는 다른 방식으로 화면단이나 서버단에 오류메시지가 발생하면, 
자바스크립트 모듈에서 미리 정의된 문구를 <small>태그에 출력하는 방식으로 진행하였다. 
이번 유효성 검사를 하면서 자바스크립트 모듈 부분이 아직 지식이 약하다는 걸 알게 되었고, 
이 부분을 좀 더 공부하여 만들어진 유효성 모듈을 다듬어서 다시 만들고 싶다.(소스 부분에 반복적인 
부분이 많아서 이부분을 손보고 싶다.)
그전에는 MessageSource, Validator를 직접 생성하여 유효성 검사 부분을 배운 적이 있었는데 
이번에는 다른방식으로 어노테이션을 이용하는 방법을 알았다.       


4. 문화기록 
- 등록, 수정 : 유효성 검사 추가(회원가입 유효성처럼 화면단, 서버단 둘다 처리)
첨부파일을 가져올 때, 파일 경로를 자바스크립트에서 URIencode로 치환해서 처리하려고 했는데, 
잘 되지 않아 서버단에서 파일명 앞부분까지 URI 처리 후에 넘김. 
- 첨부파일 원본 이미지 보기 : 모달창 아닌 animate로 이미지 화면 보여지게 처리
- 리스트, 통계형 : 윗부분에 탭버튼 추가 
- 리스트형 : 검색어 추가 
- 통계형 : 검색어 위치 변경, 월별 더블 클릭 시, 제목에 상세페이지로 넘어가도록 처리    
오류 : 검색어를 추가하는데 ReflectionException : cri(@Param 변수명) 오류가 발생하였다. 
원래 Criteria에 mno값을 추가하지 않고 Mapper부분에 @Param을 넣어 값을 구분하였는데  
Criteria에 mno를 추가하여 한값으로 통일하여 해결하였다.  

느낀점 : 서버단에서 Valid를 처리할 때, 변수 타입을 잘보고 어노테이션 처리해야 한다. 
처음에는 cdate가 필수값이라서 @NotBlank으로 지정을 하였는데, @NotBlank는 String만 가능했다.
그래서 굳이 Date형일 필요는 없어서 cdate(날짜)는 String으로 바꿔서 @NotBlank로, kind(종류)도 @Digits로
처리하였다. 이 부분은 꼼꼼히 보지 못하는 부분이라서 빼먹지 말고 자세히 봐야겠다.

유효성 체크가 false가 될 때, 첨부파일을 다시 <li>로 보여줘야했는데, 이부분은 URIencode부분을 헤맸다. 
헤매던 이유는 당연히 파일경로를 제대로 읽은 줄 알고 진행을 하였다. 하지만 로그를 찍어보니, 파일경로가 
'\'를 때문에 깨져서 읽지를 못했고, 이 부분은 서버단에서 URIencode를 해서 전달해주는 걸로 처리를 하였다.
이걸 통해 당연시 된다고 생각하지 말고, 일단 먼저 값을 로그로 찍어보고 판단 후에 진행해야겠다.


5. 게시판 
- 리스트 : 검색, 목록에 댓글수 추가
댓글수 : tb_board에 replycnt 필드 추가 
댓글 등록 +1, 삭제 -1로 업데이트 처리(트랜잭션 추가 : replycnt가 에러나면, 등록/삭제도 처리 안되도록)   
- 등록, 수정 : 유효성 검사 추가 
- 삭제 : fk_reply에 on delete cascade 추가하여 게시판 삭제 시(댓글이 있으면) 자동 삭제  
- 첨부파일 원본 이미지 보기 : 모달창 아닌 animate로 이미지 화면 보여지게 처리
>>(이미지 파일이 아닌 경우는 아직 안함)
- 게시판 종류별로 게시글이 나오도록 처리 
종류 : 공지사항, 자유게시판, 질문&답변, 문화후기 
리스트 uri : /board/list/{kind}, kind는 @pathvariable로 값 받기 
             리스트 항목을 가져올 때, @Param 어노테이션을 이용하여 Criteria, kind 두 값을 받도록 처리
             Model에 kind값 추가 
             화면단에 목록으로 가는 항목들 링크 변경   
등록/수정/삭제 컨트롤단 : uri경로 수정 
번외) 문화기록 리스트 : 다시 @Param 어노테이션을 이용
느낀점 : 기존에 했던 부분이라서 헤맨 부분은 없으나, 게시판 같은 경우에는 같은 테이블에 종류만 
나뉠 뿐이라서 첨부파일에 이미지 말고 다른 파일도 올릴 수 있는 기능을 추가해야겠다. 
그리고 리스트목록 uri 변경 부분을 처리하면서 @Param으로 두값을 받는 게 성공하여 어제 해결하지 못한
Criteria안에 mno값을 빼고 @Param값으로 받는 걸로 처리하여 해결하였다.


6. 회원관리 
- 경로 변경 : /member/myprofile/{mno} mno는 @pathvariable로 값 받기 
- 회원정보변경/비밀번호변경/회원탈퇴 : 유효성 검사 추가, RestAPI로 변경 
기존에 Post로 처리했는데 회원정보,비밀번호변경 > put, patch, 회원탈퇴 > delete 방식으로 처리 
유효성 검사 실패 시, error 리턴 처리 
- 프로필 사진 추가 : 이미지를 클릭해서 프로필 사진 교체 
프로필 사진 이미지를 변경하는데 json이 List객체를 제대로 인식을 못한 부분이 발견하여 
@ResquestBody 부분을 AttachFileVO(객체)로 받고, List형으로 바뀌는 후속 작업 처리.
- 회원탈퇴 시, 등록된 이미지 삭제 추가(foreign key로 연결X)
탈퇴사유 insert 후에 tb_member에서 삭제처리(tb_member_auth 자동 삭제 처리)
느낀점 : 정보를 변경할 시, Rest API에서도 @Valid 어노테이션을 추가하여 형식이 어긋나면
단순히 에러 메지를 리턴했는데, 좀 찾아보니 방식이 많이 있었는데 대부분 스프링 부트에 대한 내용이라서 
이해하는데 힘들었지만 해결하여 뿌듯하다. 그리고 스프링부트가 요즘에 대세라는 걸 체감하였고, 
공부해야겠다. 유효성 검사 부분은 다 해놨으나, 나중에 좀 더 보완해보고 싶은 부분이다.   

프로필 사진은 이미지 변경만 해놨는데, 변경 뿐만 아니라 삭제도 할 수 있으니, 이 부분은 
삭제 버튼을 추가해야겠다.  


# 2021-03-26 개발일지(2021-03-25까지 위의 내용 처리 완료)
1. 권한설정 
- user : 문화기록 읽기/쓰기/수정/삭제, 게시판 읽기만 가능  
  member : 문화기록, 게시판 읽기/쓰기/수정/삭제(자신이 쓴글만, 공지사항은 제외) 
  admin : 문화기록, 게시판 읽기/쓰기/수정/삭제(남의 글까지, 댓글도 동일) 
          문화기록은 멤버공개/전체공개 글만 삭제하도록 처리(아직 개발중)
위의 권한 설정으로 스프링에 적용 

2. 자동 등급 업데이트 
- user > member 등업 조건 : 방문 5회, 문화기록 5회이면 자동으로 업데이트 
로그인 기록 테이블 추가   
테이블 : tb_login_log 
필드 : idx, id, rdate 
- 로그인 성공 이후, 메인에 접속할 시 로그 insert(이미 처리했거나 admin은 제외)
- 권한 설정 가져오는 부분(CustomUserDetailService)에 로그인건수, 글등록건수를 추합하여 등급 업데이트 

3. 트랜잭션 추가 
- 트랜잭션이 필요한 부분이 더 있는지 확인 후, 추가

4. 검색어 디자인 변경 
- 문화기록, 게시판부분의 검색어부분 디자인 변경

5. 로그인실패/로그아웃 시, alert창 호출 
- 자세한 에러 메시지를 위해 커스텀으로 보완할 필요 있음. 

6. 회원관리 프로필 사진 보완 
- 사진 삭제 기능 추가 
- 사진 변경부분에서 실제 업로드된 파일이 제대로 사진이 삭제되지 않아 삭제되도록 수정완료 
느낀점 : 자동 등급 업데이트 부분은 aop 처리가 가능할 것 같다는 생각을 했다. 내일 한번 보완해야겠다. 
프로필 변경도 삭제를 하면서 사진 변경도 같이 한번 봤는데 제대로 삭제되지 않을 걸 발견했다. 
테이블에서는 삭제됐는데 실제 파일은 삭제되지 않았다. 테이블 부분만 보고 삭제됐다고 착각했다. 
다시 한번 적지만, 작업을 할때마다 꼼꼼히 결과내용을 확인하자!!! 


# 2021-03-27~29 개발일지 
1. 게시판 답글 기능 추가
- ROLE_MEMBER, ROLE_ADMIN만 생성 가능 >> user는 답글 버튼이 안보임 
- tb_board에 refno 필드 추가 
등록 : 그냥 등록과 구분되도록 타이틀, 내용에 답글 표시
목록 : 계층형을 이용하여 원글 다음에 답글이 나올 수 있도록 쿼리문 수정 
START WITH refno=0 
CONNECT BY PRIOR bno=refno 
ORDER siblings BY bno DESC
- 삭제 : 계층형을 이용하여 하위 답글이 있는 경우, 모두 삭제하도록 처리 
Delete tb_board where bno in(
SELECT bno FROM tb_board 
START WITH bno=#{bno}
CONNECT BY PRIOR bno = refno)
- 첨부파일이 포함되어 있는 경우, 모든 첨부파일 가져와 실제 파일, 디비 내용 삭제 처리 
실제 파일 삭제 : 쿼리를 통해 모든 첨부파일을 가져온 뒤, 반복문을 이용하여 list에 추가 후, 삭제 처리  
for(int i=0;i<attachList.size();i++) {
fileList.addAll(attachList.get(i).getFileList()); 	
}
디비 내용 삭제 
delete TB_ATTACH_GROUP where bno in (SELECT bno FROM tb_board 
START WITH bno=#{bno}
CONNECT BY PRIOR bno = refno)
- 화면단 : 답글은 아이콘을 이용하여 표시 

2. 댓글에 답댓글 기능 추가 
- ROLE_MEMBER, ROLE_ADMIN만 생성 가능 >> user는 답글 버튼이 안보임 
- tb_reply에 refno 필드 추가 
- 화면단 : 모달창을 연 다음에 답댓글을 누르면 댓글 새글 처럼 등록폼이 나오도록 처리 
           답글은 아이콘을 이용하여 표시 
- 서버단은 게시판과 동일하게 처리
느낀점 : 계층형에 대한 새로운 내용을 알게 되었다. 
START WITH refno=0 
CONNECT BY PRIOR bno=refno 
ORDER siblings BY bno DESC 이용하여 계층형 리스트를 만들어서 목록을 보여주는 것 쉬었는데, 
삭제 부분에서 하위 계층이 있는 경우, 통째로 모두 삭제할 것인지 아니면 삭제된 부부만 상태값만 
업데이트를 시켜할 것인지를 고민이 많이 하였다. 후자를 선택하면, 그 뒤의 처리에 경우의 수가 
많아 통째로 삭제하는 걸로 선택을 하였다. 
통째로 삭제하는 걸 결정하고 나서 게시판의 첨부파일들을 모두 가져와서 디비 내용을 삭제하는 건 
별 문제가 없지만, 물리적 삭제 부분이 하위 계층의 첨부파일을 제대로 가져오지 못해 좀 해맸지만, 
반복문을 이용하여 손쉽게 해결하였다. 
이를 통해 여러가지 경우의 수를 생각하고 그에 따른 해결하는 방법을 잘 생각해보고 설계를 해야겠구나를 느꼈다. 


# 2021-03-30 개발일지 
1. 통합검색 
- 최상단의 검색을 이용하여 모든 게시판들을 통합 검색
엔터키나 검색버튼을 눌러 submit처리 
- 문화기록, 게시판에 따라 검색된 내용이 최신순으로 리스트가 나오도록 처리(3개씩) 
더보기를 눌러 내용을 추가 >> 없으면 더보기 버튼 hide처리 
- 타이틀 클릭 시, 해당 상세 내용으로 이동 
문화기록 상세 : 타이틀 : 나의 기록 상세 > 문화기록 상세로 변경. 수정/삭제/목록 버튼 안나오게 처리 

2. 관리자 페이지 설계 
- 회원관리(회원정보,회원로그), 신고사유, 탈퇴사유, 문화기록, 게시판으로 페이지를 나눴고, 각 페이지별로
내용은 문화기록 문서에 추가  
느낀점 : 통합검색은 기존 리스트, 검색 기능을 이용하여 손쉽게 해결하였다. 이번에는 특별하게 페이징을 
더보기 기능을 이용하여 페이징 처리하였다. 상세페이지으로 넘어간 후 이전 통합검색 페이지로 넘어갈 경우, 
기존 페이징이 유지되지 않아 이 점을 고쳐야겠다. 
멤버 페이지는 거의 다 완료를 하였고, 관리자 페이지를 오늘 설계한 내용을 바탕으로 만들어야겠다. 

# 2021-03-31~04-02 개발일지
1. 회원리스트 
- 검색기능 : 일반, 블락, 강퇴 회원 조회
- 조회버튼 : 최근의 1개 로그를 가져와서 내역 조회 
- 변경버튼 : 등급, 블락, 강퇴에 따라 로그 작성 
- 아이디 클릭 시, 회원 상세 페이지로 이동 
- 로그 등록/수정 : 유효성 검사 추가 

2. 회원 상세 
- 회원정보 출력 : 공개여부에 따라 회원정보 나오도록 출력 
- 로그버튼 : 로그 상세 페이지로 이동
- 목록버튼 : 리스트로 이동 
- 문화기록, 게시판 건수 및 최근 리스트 나오도록 함 

3. 탈퇴리스트 
- 아이디 클릭 시, 상세 페이지로 이동
- 상세 : 탈퇴 정보 출력 >> 목록 : 리스트로 이동 

4. 로그리스트
- 아이디별 건수 리스트 출력
- 검색기능 : 아이디 검색 
- 아이디 클릭 시, 상세 페이지로 이동 

5. 로그상세 
- 로그 히스토리 출력
- 더보기버튼 : 페이징 처리 (3개씩 가져와서 리스트에 추가, 없으면 alert창) 
- 목록버튼 : 리스트페이지로 이동

# 2021-04-03 개발일지 
1. 신고리스트 
- 검색기능 : 제목, 신고자, 내용, 복합검색 
- 제목 클릭 시, 신고 상세 페이지로 이동 
- 관리자는 모든 내역, 신고자는 자기가 신고한 내역이 나오도록 처리
  >> reportert(파라미터) == all, 관리자 
                       == 유저아이디, 회원

2. 신고 상세 
- 신고정보 출력 : 회원권한에 따라 신고정보 나오도록 출력(아직 회원은 작업X)
- 수정버튼 : 회원권한에 따라 신고정보 수정(아직 회원은 작업X) 
- 삭제버튼 : 신고 삭제하면서 게시글의 신고 정보도 초기화 
- 목록 : 리시트 페이지로 이동 
- 검색 : 신고된 게시글로 새 페이지로 열기 

3. 신고 팝업창 
- 문화기록, 게시판 상세 상단에 신고하기 기능 추가 
신고가 없는 경우 신고하기, 신고가 있는 경우 신고 처리중으로 >> 문구 클릭 시, 팝업창이 뜸.  
- 신고자만 수정/삭제 가능. 아닌 경우, alert창으로 신고 처리중 메시지 호출 
관리자가 처리 전일 경우만 수정/삭제 가능(처리 후 alert창으로 수정할 수 없습니다 메시지 호출)

# 2021-04-05 개발일지 
1. 권한 추가 
- 관리자 모든 페이지에 권한 추가(관리자만 접근하도록) 

2. 신고리스트
- 신고 등록 : 멤버(ROLE_MEMBER)만 등록하도록 수정 
- 신고 수정/삭제 : 멤버, 관리자만 수정하도록 수정 
- 신고 상세 : 멤버/관리자에 따라 수정하는 부분 다르게 수정 

3. 문화기록 
- 멤버, 관리자에 따라 리스트 보이도록 수정 >> 목록으로 올때 부분 모두 수정
멤버 : 자기꺼만(멤버 번호), 관리자 : 멤버공개, 전체공개만(0으로 조회)

4. 레프트 메뉴, 메인화면
- 멤버, 관리자에 따라 보이도록 수정 

# 2021-04-05 개발일지 
1. 신고리스트 유효성 검사 추가 
- 팝업창(등록/수정), 수정페이지에 화면단, 서버단 모두 유효성 검사 추가 

2. 신고리스트 탭 추가
- 오른쪽 상단에 전체/처리중/완료/미처리 탭 처리
- 탭에 따라 내용 달라지게, 탭 active 처리  
- 다른 페이지로 이동 후 다시 목록으로 돌아올 경우, requestParam으로 넘겨 상태값 유지되도록 함 

3. 멤버 로그 수정/삭제 기능 추가 
- 로그 상세에 로그 테이블에 각각 수정/삭제버튼 추가 
- 수정 : 수정페이지로 이동 >> 메모만 수정 가능 
- 삭제 : 바로 삭제 처리 

4. 나의 활동 추가 
- 멤버회원만 활동에 대한 페이지 추가 
- 로그인, 문화기록, 게시판, 댓글 수 건수 출력 
- 게시판, 댓글은 탭을 이용하여 리스트 출력 >> 더보기를 눌러 내용 더 가져오기 
  타이틀 클릭 시, 상세 화면으로 이동(문화기록은 레프트메뉴에 리스트/통계형식으로 있으므로 생략)

# 2021-04-07~08 개발일지 
1. 아이디/비밀번호 찾기 추가 
- 아이디찾기 : 이름, 이메일을 조회해서 아이디 결과 나오게 처리 
- 비밀번호찾기 : 아이디, 이메일을 조회해서 유효성 검사가 통과되면 이메일로 전송 
                통과되지 못하면, alert창으로 에러메시지 호출
유효성 검사 : 아이디, 이메일이 등록되는지 확인  

2. 블락, 강퇴회원 로그인 실패 처리 추가 
- userDetail 커스텀 클래스에 블락, 강퇴 회원인 경우, return null로 처리. 
블락 회원은 블락 기간이 지날 경우 satate를 업데이트 한 후, 로그인 성공 처리 

3. culture, member쪽 소스 정리 
- culture : mno, id를 둘이 번갈아가면서 조회, 수정, 삭제, 데이터 값 리턴 등을 쓰고 있어  
이 부분을 id로 통일하였고, 테이블(tb_culture)에 writer 필드 추가 
- member : myprofile의 대부분을 mno로 조회했는데, id로 통일 
느낀점 : 비밀번호 찾기에서 이메일 전송을 이용하였는데, 처음에는 구글 이메일 계정으로 시도를 했는데 
실패를 하였다. 보안 접근성을 낮췄는데 안되는 건가 생각했는데 네이버 이메일로 전송을 해보니, 
제대로 이메일 전송을 할 수 있었다. 나중에 한번 구글 이메일로 다시 한번 시도를 해봐야겠다. 
smtp을 이용하여 임시 비밀번호를 발급 이메일 전송할 수 있도록 처리하였다. 

커스텀을 이용하여 로그인 실패 서비스를 이용하려고 했는데, 이부분은 자꾸 에러가 나 일단 
userDetail 커스텀 클래스을 이용하여 블락, 강퇴회원을 로그인 못하도록 처리하였다. 
시큐리티 부분은 좀 더 공부를 하고 한번 다시 시도를 해봐야겠다. 

# 2021-04-09,11 개발일지 
1. 모든 유효성 검사 제대로 작동되는지 테스트 및 오류 수정
2. 에러페이지 수정 

# 2021-04-17 개발일지 
1. 로그인 실패 수정 
- 로그인 실패 커스텀 추가 및 에러 메시지 호출

# 2021-04-20 개발일지
1. 쪽지 테이블 구성 
- 테이블명 : tb_message 
- 필드 : mno(pk), sender, target, message, sdate, odate, udate, refno 

2. Persistence, Service, Controller 완료 

# 2021-04-21 개발일지
1. 쪽지페이지 완료 
- 탭(받은쪽지, 보낸쪽지)에 따라 리스트 출력
- 각 항목을 클릭 시, 모달창으로 상세내역 조회 
- 받은쪽지 : 답변/삭제, 보낸쪽지 : 수정/삭제
  답변 : 이미 답할 경우, 버튼 숨김 
  수정 : 쪽지를 읽었을 경우, 버튼 숨김 

2. 문화/게시판 상세페이지에 쪽지 등록 추가 
- 버튼 클릭 시, 모달창으로 등록폼 나옴 
- 멤버, 관리지만 등록 가능 

3. header에 쪽지함 추가 

# 2021-04-23 개발일지 
1. 쪽지 알림 기능 추가 
- WebSocket을 이용하여 유저가 접속 시, 읽지 않은 쪽지 건수 가져오도록 셋팅
- 화면단에는 footer.jsp에 sockjs-client(https://github.com/sockjs/sockjs-client)을 이용, 
  가져온 건수를 읽어 상단 쪽지아이콘에 뱃지로 표시하도록 처리 
   



