# 데일리 개발일지

## 2021.02.22 일지  
1. 테이블 생성
- 테이블명 : culture 
- 필드 : cno(PK), cdate, kind, title, content, rank, rdate, update, mno(FK) 
         추후에 mno를 FK로 추가할 예정(member테이블 생성X) 
2. 영속 계층 CRUD 구현 
- VO : CultureVO 
- Mapper 인터페이스, Mapper XML : CultureMapper
- CRUD 구현하기 전, culture 전체 리스트를 가져오는 sql 테스트 
- CRUD 구현 후, 각각 테스트
  C(insert)부분에 cdate는 sysdate로 고정으로 테스트 >> 임의의 날짜 데이트도 잘 들어가는지 확인 완료
3. 비즈니스 계층 CRUD 구현 
- CultureService, CultureServiceImpl(CultureService Implement)
- 영속계층에 만들어낸 CRUD를 토대로 Service계층을 구현 후, 각각 테스트 

느낀점 : VO > Mapper > Service순 까먹지 말 것. 
급하게 말고 천천히 테스트 해보며 진행할 것. 
git에 대한 지식이 부족하여 현 프로젝트를 repository하는데 시간이 오래 걸림 >> 지식 습득 필요 

## 2021.02.22 일지 
1. 웹 계층 CRUD 구현 
- CultureController에 아래와 같은 표로 구현 
|구분|URL|Method|Parameter|From|URL이동|
|------|---|---|---|---|---|
|목록|/culture/list|get||||
|상세|/culture/get|get|cno|||
|등록|/culture/register|post|모든항목|입력화면필요|O|
|수정|/culture/modify|post|모든항목|입력화면필요|O|
|삭제|/culture/remove|post|cno|입력화면필요|O|
- MockMVC로 각각 화면 테스트 
2. 화면단 처리 
- [부트스트랩을 이용](https://startbootstrap.com/theme/sb-admin-2)
- 나의 기록 목록 화면 완료, 현재 등록폼 작성중 

오류 : java.lang.NoClassDefFoundError: javax/servlet/SessionCookieConfig
Junit으로 테스트 케이스를 만들어 세션에 어떤 작업을 할 때, MockHttpSession 객체를 생성하게 되는데, 서블릿 버전 3.1 이하에서는 SessionCookieConfig 클래스를 찾지 못하는 오류가 발생  
해결책 : 서블릿 jar 파일을 3.1 버전으로 업데이트 해 주면 해결된다.
오류 : java.lang.IllegalStateException: Failed to load ApplicationContext
Caused by: java.io.FileNotFoundException: src\main\webapp\WEB-INF\spring\servlet-context.xml (지정된 파일을 찾을 수 없습니다)
해결책 : 파일 경로가 제대로 되는지 한번 더 체크 
느낀점 : 두개의 오류가 발생한 이유는 테스트를 급하게 하느라 발생하는 것으로, 한번 더 체크하는 습관을 들이도록 하자

## 2021.02.24 일지 
1. 상세, 등록, 수정, 삭제 완료 
- 등록/수정/삭제 처리 후, 모달창 띄우기 완료 

오류 : 뒤로가기 문제 
등록 처리 후, 다시 뒤로 갔다가 되돌아오면 모달창이 띄워지는 문제가 발생
해결책 : history API의 replaceState 이용하여 초기화해준 뒤, 모달창 나오지 않게 막음  

## 2021.02.25 일지 
1. 페이징 처리 및 파일첨부 
- 페이징처리완료, 파일첨부 진행 중 
- 페이징 처리 : 한페이지당 10개씩 보이도록 처리 
VO : Criteria(페이지번호, 개수), PageVO(시작,페이지,pre,next 만듬) >> Model에 전달 
상세/수정 > 목록으로 돌아올 때, 그 페이지 목록으로 돌아오도록 함(페이지번호, 개수를 hidden으로 전달)
- 파일 첨부 : 서블릿3.0 API, ajax 이용 
ajax 처리 : 파일 업로드, 삭제, 파일 보기  

오류 : 파일첨부 재첨부 문제 
파일을 업로드하고 나서 재첨부를 할 경우, 첨부가 되지 않는 오류가 발생. 
아직 해결은 못했으나, 아래와 같은 방법으로 오류를 해결할까 구상중
첨부된 파일을 그대로 둔 채, 파일을 첨부할 수 있는 방법 필요(각 파일의 넘버링 필요)
느낀점 : 페이징, 파일첨부는 회사에서 해왔던 방식은 비슷하나, 용어나 문법에 다소 약하는 걸 느꼈다. 
다른 페이지쪽을 할때, 다시 한번 작업을 하면서 감각을 기르자.   

## 2021.02.26~03.01 일지 
1. 파일 첨부 작업 
- 테이블 생성 및 등록화면 화면 수정 완료 
- 테이블 : tb_attach_group
  필드   : gno(PK), rdate, mno, cno(FK), bno
           mno, bno는 나중에 외래키로 등록할 예정 
- 테이블 : tb_attach 
  필드   : uuid(PK), fileName, fileType, gno(FK), path
- 두 테이블에 있는 값을 조회/등록/삭제할 수 있도록 쿼리 테스트 완료 
- 파일 첨부 등록/조회/수정/삭제 완료(3일 정도 소요)
삭제는 게시글을 아예 삭제하는 경우, 첨부파일을 삭제하는 경우를 나눠서 삭제처리함 

새로 배운 내용 : mybatis에서 조인된 테이블들을 select, insert 하는 부분을 배웠다. 
테이블 조회 - resultMap을 이용하여 각 VO를 선언 후, 부모VO에다가 collection으로 연결하여 테이블 조회
insert all - insert all은 한꺼번에 테이블을 동시에 insert하는 것. 
mybatis에서는 insert all을 하기 위해서는 paramterType은 List로, begin = "insert all", end="select * from dual"을 명시.
select * from dual을 명시하지 않으면, 오류 발생(오라클 sql문법 자체에서 insert all 뒤에 꼭 서브쿼리가 붙음)
delete문 같은 경우에는 두 개의 다른 테이블을 동시에 삭제하는 방법을 찾아봤으나, 알 수가 없어 따로 delete문을 만듬
tb_attach(FK) > tb_attach_group 순으로 삭제 처리하도록 함  
느낀점 : 두개의 테이블이 1:N의 관계이기 때문에 영속계층부터 생각하면서 진행하다보니 시간을 많이 잡아먹었다. 
특히 등록화면에서 파일첨부 후, <form>태그 안에 첨부된 파일들을 <input>값으로 추가하는데 시간이 오래 걸렸으나, 
한개의 테이블이 아닌 연결된 테이블을 이용하여 CRUD 구현함으로써 새로운 문법을 알아가는 건 뿌듯했다.  
동시에 mybatis, sql문, 자바스크립트(list)를 완벽하게 알지 못한다는 부족함이 보여 보완해야겠다.   
오류 : 모달창 닫기버튼 오류 
첨부된 이미지를 클릭 시, 모달창으로 원본 이미지가 보이는데 X 버튼은 제대로 작동하나, close 버튼을 누르면 리스트로 넘어가는 
오류가 발생  

## 2021.03.02~03.07 일지 
1. 통계화면 
- 기존 CultureVO에서 day, sum 추가, Criteria에서 sDate, eDate 추가 
day : 날짜, sum : 건수, sdate : 시작일, edate : 종료일 
월별,통계 : 월의 시작일~막일, 연별 : 1월 1일 ~ 당월 막일 
날짜는 Date 대신 String으로 처리. 
- 영속~서비스계층 완료, 화면단 작업중
새로 배운 내용 : TO_CHAR, TO_DATE 형변환 함수 
TO_CHAR : 날짜 또는 숫자를 문자열로 변환하는 함수 
TO_DATE : 날짜형 데이터로 변환하는 함수

느낀점 : 쿼리의 조건절을 Date객체를 넘겨서 데이터를 출력하려고 했는데, 원하는 대로 나오지 않아 
String으로 전환을 하였다. 일단 내용은 나오는데 성공했으니, 화면단까지 마무리 짓고나서 구글링을 통해 더 나은 방법있는지 
찾아봐야겠다. 

2. 화면단 처리 완료 
일별, 연별, 그래프별로 가져올 때, 쿼리 부분이 달라 따로 지정을 하고, ajax으로 탭 항목 별로 가져오도록 처리 
- 월별의 일을 더블 클릭 시, 요약화면 모달창 띄움
  연별 더블 클릭 시, 월별 화면으로 이동  
  그래프 더블 클릭 시, 요약화면 모달창 띄움 
- 날짜 검색은 datepicker를 이용하고, 년-월만 보이도록 처리 

새로 배운 내용 : 비율 계산 
비율계산을 하기 위해서는 대표값, 합계을 가지고 ratido 처리를 한다 
ROUND(RATIO_TO_REPORT(count(*)) over(PARTITION BY GROUPING_ID(kind)) * 100,0) as ratio

오류 : 그래프쪽 이전 데이터가 나오는 문제 
날짜를 검색해서 새로운 내용을 가져오면 이전 데이터 값이 나오는 문제가 발생 
해결책 : 이전 컨버스를 삭제하고 다시 컨버스를 새로 생성하는 걸로 처리하여 해결 
느낀점 : 통계화면은 내용을 보여주는 페이지이기 때문에 간단하게 끝날줄 알았는데 
각 탭별로 출력화면이 달라(달력, 표, 차트) 어떻게 비슷하게 통일을 해야 하나 고민이 많았는데, 
생각한대로 구현되어 뿌듯하고, 나중에 등록/수정/삭제 기능을 추가해서 보완해야겠다. 

## 2021.03.08 일지
1. 테이블 생성 
    - 테이블명 : tb_board
    - 필드 : bno(PK), kind, title, content, writer, rdate, udate 
2. 영속계층~화면단 처리 완료 
리스트, CRUD 구현, 페이징처리까지 완료 

느낀점 : culture와 유사하기 때문에 한번 더 해보았는데, 헷갈리는 부분이나 까먹은 부분을 
상기할 수 있어서 복습차원에서 괜찮았다. (부족한 부분 : MockMVC쪽 공부, 페이징 처리, 자바스크립트쪽)  

## 2021.03.09~03.10 일지
1. 댓글 추가 
Restful API를 이용하여 댓글 화면, 추가, 수정, 삭제 처리 
느낀점 : RestController, Restful API 연습을 더 해봐야겠다.   

## 2021.03.13~03.14 일지 
1. 회원가입 등록폼 완료 

## 2021.03.15~03.16 일지 
1. 테이블 생성
    - 테이블명 : tb_member
    - 필드 : mno(pk), id, pw, name, phone, email, favorites, rdate, udate, enabled
    - 테이블명 : tb_meber_auth
    - 필드 : auth, mno(fk)
2. 로그인 처리(처리 중) 
-스프링 시큐리티를 이용한 로그인/로그아웃 테스트 완료 
내가 만들었던 테이블을 이용하기 위해 custom방식으로 만들었고, 
비밀번호는 BCryptPasswordEncoder 클래스를 이용 
- 에러페이지, 로그인 성공, 로그아웃도 custom방식 사용 
느낀점 : 기존에는 쿠키나 세션 값을 넘겨서 로그인 성공/실패를 처리하였는데, 스프링에서는 시큐리티가 있어 
로그인/로그아웃 기능을 구현할 수 있어 편리했다. 
어떻게 시큐리티가 처리하였는지 알았으므로 custom방식 위주로 연습을 많이 해야겠다.   

- 로그인 화면단 수정, 문화/게시판 시큐리티 처리완료, 로그아웃 수정완료 
등록 : 로그인 상태에서만 등록 가능 
수정/삭제 : 작성자만 가능 
로그아웃 : 로그아웃 화면 넘어가는 대신 바로 로그아웃 처리 완료 
- 메인화면 처리중
새로 배온 내용 : 어노테이션을 활용하여 시큐리티 처리 방법에 대해 배웠다. 
어노테이션을 하기 위해서는 servlet-context.xml에 시큐리티를 추가 후, 
@PreAuthorize()의 표현식에 따라 검사한다. 
jsp에서도 시큐리티에 관한 라이브러리를 임포트 후, 
<sec> 태그를 이용하여 시큐리티를 처리할 수 있고, 로그인된 회원정보를 principal을 이용한다.  

느낀점 : 스프링에서나 jsp에서 시큐리티 처리하는 방법을 알 수 있어 뿌듯했고, 오늘은 단순히 
로그인유무, 작성자인지만 체크하였는데, 권한에 따라서 수정해야겠다. 
현재 권한은 ROLE_USER, ROLE_MEMBER, ROLE_ADMIN으로 했는데,   
ROLE_USER : 문화기록 읽기/쓰기/수정 가능, 게시판은 읽기만 가능 
ROLE_MEMBER : 문화기록or게시판(공지사항 제외) 읽기/쓰기/수정 가능
ROLE_ADMIN : 문화기록은 권한X, 게시판 읽기/쓰기/수정 가능  
현재 이렇게 생각을 하고 있는데, 소스가 대충 마무리 되면 다시 권한을 설정을 검토해야겠다. 
- 회원가입, 메인화면 처리완료
느낀점 : 회원가입 유효성 검사를 위한 자바스키립트 모듈 필요, 게시판 종류에 따라 나누도록 수정
보완 필요 

- 회원정보 처리완료 
정보 변경(회원정보, 비밀번호), 회원탈퇴, 로그아웃 > 모달창으로 띄워서 처리 완료 
느낀점 : 계획했던 홈페이지의 큰 가닥은 끝났고, 그 동안에 못했던 부분이나 부족한 부분들은 
개발일지나 메모를 참고해서 세부적으로 수정해야겠다. 

## 2021-03-16 일지 
1. 게시판, 멤버에 첨부파일 추가
- fK_culture_group 삭제 : 기존에 foreign key 여러개를 걸어 진행하려고 했으나, 
여러 테이블의 PK를 foreign key로 등록할 수 없어 전에 생성한 fk_culture_group을 삭제 처리 
- 자식 테이블 자동 삭제 : fk에 on delete cascade 속성 추가 
기존에는 이 속성을 주지 않아 tb_attach_group, tb_attach를 둘 다 삭제 처리를 했으나, 
tb_attach의 fk_attach에 속성을 추가하여 tb_attach_group 하나만 삭제 처리하다록 수정 
- 첨부파일 생성, 수정은 기존에 처리했던 대로 똑같이 추가함(기준값 : cno, bno, mno)
cno : 문화기록 PK, bno : 게시판 PK, mno : 멤버 PK(문화기록/게시판 처리완료, 멤버 진행중) 
- 자바스크립트 공통 부분을 찾아서 따로 정리중
- 모달창(진행중) : 게시판 모달창 : 댓글, 이미지 원본 불러오기 곁침 
          회원 모달창 : 회원정보 변경, 비밀번호변경, 회원탈퇴, 이미지 원본 불러오기 곁침 
- 회원정보 이미지(진행중) : 첨부파일 <input>을 넣지 말고, 이미지 자체에서 파일 변경 

2. 로그인 
- 엔터키 누르면, 로그인 submit() 처리 완료
- 부트스트랩 .needs-validation을 이용하여 유효성 체크 

3. 회원가입 
- 화면단, 서버단 둘다 유효성 검사 체크(목적 : 이중체크) 
화면단 : 입력란을 blur후에 값이 제대로 입력되는지를 판단 >> invalid면 오류문구(color:red), valid면 유효문구(color:green), 오류문구삭제 
         submit 전에 한번 더 체크
서버단 : Validation 어노테이션을 이용하여 유효성 체크 >> javax.validation, org.hibernate.validator 라이브러리 추가 
        MemberVO : id, pw, pw2(확인용 암호), 이름, 이메일 유효성 관련 어노테이션 추가
        MemberController : MemberVO 유효성 검사가 false면 로그인폼(입력된 항목을 같이 전달), true면 로그인화면으로(BindingResult 이용)
느낀점 : 예전에는 화면단에는 간단하게 alert, 서버단에서는 <form> 태그를 이용하여 
오류메시지를 전달했는데, 이번에는 다른 방식으로 화면단이나 서버단에 오류메시지가 발생하면, 
자바스크립트 모듈에서 미리 정의된 문구를 <small>태그에 출력하는 방식으로 진행하였다. 
이번 유효성 검사를 하면서 자바스크립트 모듈 부분이 아직 지식이 약하다는 걸 알게 되었고, 
이 부분을 좀 더 공부하여 만들어진 유효성 모듈을 다듬어서 다시 만들고 싶다.(소스 부분에 반복적인 
부분이 많아서 이부분을 손보고 싶다.)
그전에는 MessageSource, Validator를 직접 생성하여 유효성 검사 부분을 배운 적이 있었는데 
이번에는 다른방식으로 어노테이션을 이용하는 방법을 알았다.       


4. 문화기록 
- 등록, 수정 : 유효성 검사 추가(회원가입 유효성처럼 화면단, 서버단 둘다 처리)
첨부파일을 가져올 때, 파일 경로를 자바스크립트에서 URIencode로 치환해서 처리하려고 했는데, 
잘 되지 않아 서버단에서 파일명 앞부분까지 URI 처리 후에 넘김. 
- 첨부파일 원본 이미지 보기 : 모달창 아닌 animate로 이미지 화면 보여지게 처리
- 리스트, 통계형 : 윗부분에 탭버튼 추가 
- 리스트형 : 검색어 추가 
- 통계형 : 검색어 위치 변경, 월별 더블 클릭 시, 제목에 상세페이지로 넘어가도록 처리    
오류 : 검색어를 추가하는데 ReflectionException : cri(@Param 변수명) 오류가 발생하였다. 
원래 Criteria에 mno값을 추가하지 않고 Mapper부분에 @Param을 넣어 값을 구분하였는데  
Criteria에 mno를 추가하여 한값으로 통일하여 해결하였다.  

느낀점 : 서버단에서 Valid를 처리할 때, 변수 타입을 잘보고 어노테이션 처리해야 한다. 
처음에는 cdate가 필수값이라서 @NotBlank으로 지정을 하였는데, @NotBlank는 String만 가능했다.
그래서 굳이 Date형일 필요는 없어서 cdate(날짜)는 String으로 바꿔서 @NotBlank로, kind(종류)도 @Digits로
처리하였다. 이 부분은 꼼꼼히 보지 못하는 부분이라서 빼먹지 말고 자세히 봐야겠다.

유효성 체크가 false가 될 때, 첨부파일을 다시 <li>로 보여줘야했는데, 이부분은 URIencode부분을 헤맸다. 
헤매던 이유는 당연히 파일경로를 제대로 읽은 줄 알고 진행을 하였다. 하지만 로그를 찍어보니, 파일경로가 
'\'를 때문에 깨져서 읽지를 못했고, 이 부분은 서버단에서 URIencode를 해서 전달해주는 걸로 처리를 하였다.
이걸 통해 당연시 된다고 생각하지 말고, 일단 먼저 값을 로그로 찍어보고 판단 후에 진행해야겠다.


5. 게시판 
- 리스트 : 검색, 목록에 댓글수 추가
댓글수 : tb_board에 replycnt 필드 추가 
댓글 등록 +1, 삭제 -1로 업데이트 처리(트랜잭션 추가 : replycnt가 에러나면, 등록/삭제도 처리 안되도록)   
- 등록, 수정 : 유효성 검사 추가 
- 삭제 : fk_reply에 on delete cascade 추가하여 게시판 삭제 시(댓글이 있으면) 자동 삭제  
- 첨부파일 원본 이미지 보기 : 모달창 아닌 animate로 이미지 화면 보여지게 처리
>>(이미지 파일이 아닌 경우는 아직 안함)
- 게시판 종류별로 게시글이 나오도록 처리 
종류 : 공지사항, 자유게시판, 질문&답변, 문화후기 
리스트 uri : /board/list/{kind}, kind는 @pathvariable로 값 받기 
             리스트 항목을 가져올 때, @Param 어노테이션을 이용하여 Criteria, kind 두 값을 받도록 처리
             Model에 kind값 추가 
             화면단에 목록으로 가는 항목들 링크 변경   
등록/수정/삭제 컨트롤단 : uri경로 수정 
번외) 문화기록 리스트 : 다시 @Param 어노테이션을 이용
느낀점 : 기존에 했던 부분이라서 헤맨 부분은 없으나, 게시판 같은 경우에는 같은 테이블에 종류만 
나뉠 뿐이라서 첨부파일에 이미지 말고 다른 파일도 올릴 수 있는 기능을 추가해야겠다. 
그리고 리스트목록 uri 변경 부분을 처리하면서 @Param으로 두값을 받는 게 성공하여 어제 해결하지 못한
Criteria안에 mno값을 빼고 @Param값으로 받는 걸로 처리하여 해결하였다.


6. 회원관리 
- 경로 변경 : /member/myprofile/{mno} mno는 @pathvariable로 값 받기 
- 회원정보변경/비밀번호변경/회원탈퇴 : 유효성 검사 추가, RestAPI로 변경 
기존에 Post로 처리했는데 회원정보,비밀번호변경 > put, patch, 회원탈퇴 > delete 방식으로 처리 
유효성 검사 실패 시, error 리턴 처리 
- 프로필 사진 추가 : 이미지를 클릭해서 프로필 사진 교체 
프로필 사진 이미지를 변경하는데 json이 List객체를 제대로 인식을 못한 부분이 발견하여 
@ResquestBody 부분을 AttachFileVO(객체)로 받고, List형으로 바뀌는 후속 작업 처리.
- 회원탈퇴 시, 등록된 이미지 삭제 추가(foreign key로 연결X)
탈퇴사유 insert 후에 tb_member에서 삭제처리(tb_member_auth 자동 삭제 처리)
느낀점 : 정보를 변경할 시, Rest API에서도 @Valid 어노테이션을 추가하여 형식이 어긋나면
단순히 에러 메지를 리턴했는데, 좀 찾아보니 방식이 많이 있었는데 대부분 스프링 부트에 대한 내용이라서 
이해하는데 힘들었지만 해결하여 뿌듯하다. 그리고 스프링부트가 요즘에 대세라는 걸 체감하였고, 
공부해야겠다. 유효성 검사 부분은 다 해놨으나, 나중에 좀 더 보완해보고 싶은 부분이다.   

프로필 사진은 이미지 변경만 해놨는데, 변경 뿐만 아니라 삭제도 할 수 있으니, 이 부분은 
삭제 버튼을 추가해야겠다.  


## 2021-03-26 일지(2021-03-25까지 위의 내용 처리 완료)
1. 권한설정 
- user : 문화기록 읽기/쓰기/수정/삭제, 게시판 읽기만 가능  
  member : 문화기록, 게시판 읽기/쓰기/수정/삭제(자신이 쓴글만, 공지사항은 제외) 
  admin : 문화기록, 게시판 읽기/쓰기/수정/삭제(남의 글까지, 댓글도 동일) 
          문화기록은 멤버공개/전체공개 글만 삭제하도록 처리(아직 개발중)
위의 권한 설정으로 스프링에 적용 

2. 자동 등급 업데이트 
- user > member 등업 조건 : 방문 5회, 문화기록 5회이면 자동으로 업데이트 
로그인 기록 테이블 추가   
테이블 : tb_login_log 
필드 : idx, id, rdate 
- 로그인 성공 이후, 메인에 접속할 시 로그 insert(이미 처리했거나 admin은 제외)
- 권한 설정 가져오는 부분(CustomUserDetailService)에 로그인건수, 글등록건수를 추합하여 등급 업데이트 

3. 트랜잭션 추가 
- 트랜잭션이 필요한 부분이 더 있는지 확인 후, 추가

4. 검색어 디자인 변경 
- 문화기록, 게시판부분의 검색어부분 디자인 변경

5. 로그인실패/로그아웃 시, alert창 호출 
- 자세한 에러 메시지를 위해 커스텀으로 보완할 필요 있음. 

6. 회원관리 프로필 사진 보완 
- 사진 삭제 기능 추가 
- 사진 변경부분에서 실제 업로드된 파일이 제대로 사진이 삭제되지 않아 삭제되도록 수정완료 
느낀점 : 자동 등급 업데이트 부분은 aop 처리가 가능할 것 같다는 생각을 했다. 내일 한번 보완해야겠다. 
프로필 변경도 삭제를 하면서 사진 변경도 같이 한번 봤는데 제대로 삭제되지 않을 걸 발견했다. 
테이블에서는 삭제됐는데 실제 파일은 삭제되지 않았다. 테이블 부분만 보고 삭제됐다고 착각했다. 
다시 한번 적지만, 작업을 할때마다 꼼꼼히 결과내용을 확인하자!!! 


## 2021-03-27~29 일지 
1. 게시판 답글 기능 추가
- ROLE_MEMBER, ROLE_ADMIN만 생성 가능 >> user는 답글 버튼이 안보임 
- tb_board에 refno 필드 추가 
등록 : 그냥 등록과 구분되도록 타이틀, 내용에 답글 표시
목록 : 계층형을 이용하여 원글 다음에 답글이 나올 수 있도록 쿼리문 수정 
START WITH refno=0 
CONNECT BY PRIOR bno=refno 
ORDER siblings BY bno DESC
- 삭제 : 계층형을 이용하여 하위 답글이 있는 경우, 모두 삭제하도록 처리 
Delete tb_board where bno in(
SELECT bno FROM tb_board 
START WITH bno=#{bno}
CONNECT BY PRIOR bno = refno)
- 첨부파일이 포함되어 있는 경우, 모든 첨부파일 가져와 실제 파일, 디비 내용 삭제 처리 
실제 파일 삭제 : 쿼리를 통해 모든 첨부파일을 가져온 뒤, 반복문을 이용하여 list에 추가 후, 삭제 처리  
for(int i=0;i<attachList.size();i++) {
fileList.addAll(attachList.get(i).getFileList()); 	
}
디비 내용 삭제 
delete TB_ATTACH_GROUP where bno in (SELECT bno FROM tb_board 
START WITH bno=#{bno}
CONNECT BY PRIOR bno = refno)
- 화면단 : 답글은 아이콘을 이용하여 표시 

2. 댓글에 답댓글 기능 추가 
- ROLE_MEMBER, ROLE_ADMIN만 생성 가능 >> user는 답글 버튼이 안보임 
- tb_reply에 refno 필드 추가 
- 화면단 : 모달창을 연 다음에 답댓글을 누르면 댓글 새글 처럼 등록폼이 나오도록 처리 
           답글은 아이콘을 이용하여 표시 
- 서버단은 게시판과 동일하게 처리
느낀점 : 계층형에 대한 새로운 내용을 알게 되었다. 
START WITH refno=0 
CONNECT BY PRIOR bno=refno 
ORDER siblings BY bno DESC 이용하여 계층형 리스트를 만들어서 목록을 보여주는 것 쉬었는데, 
삭제 부분에서 하위 계층이 있는 경우, 통째로 모두 삭제할 것인지 아니면 삭제된 부부만 상태값만 
업데이트를 시켜할 것인지를 고민이 많이 하였다. 후자를 선택하면, 그 뒤의 처리에 경우의 수가 
많아 통째로 삭제하는 걸로 선택을 하였다. 
통째로 삭제하는 걸 결정하고 나서 게시판의 첨부파일들을 모두 가져와서 디비 내용을 삭제하는 건 
별 문제가 없지만, 물리적 삭제 부분이 하위 계층의 첨부파일을 제대로 가져오지 못해 좀 해맸지만, 
반복문을 이용하여 손쉽게 해결하였다. 
이를 통해 여러가지 경우의 수를 생각하고 그에 따른 해결하는 방법을 잘 생각해보고 설계를 해야겠구나를 느꼈다. 


## 2021-03-30 일지 
1. 통합검색 
- 최상단의 검색을 이용하여 모든 게시판들을 통합 검색
엔터키나 검색버튼을 눌러 submit처리 
- 문화기록, 게시판에 따라 검색된 내용이 최신순으로 리스트가 나오도록 처리(3개씩) 
더보기를 눌러 내용을 추가 >> 없으면 더보기 버튼 hide처리 
- 타이틀 클릭 시, 해당 상세 내용으로 이동 
문화기록 상세 : 타이틀 : 나의 기록 상세 > 문화기록 상세로 변경. 수정/삭제/목록 버튼 안나오게 처리 

2. 관리자 페이지 설계 
- 회원관리(회원정보,회원로그), 신고사유, 탈퇴사유, 문화기록, 게시판으로 페이지를 나눴고, 각 페이지별로
내용은 문화기록 문서에 추가  
느낀점 : 통합검색은 기존 리스트, 검색 기능을 이용하여 손쉽게 해결하였다. 이번에는 특별하게 페이징을 
더보기 기능을 이용하여 페이징 처리하였다. 상세페이지으로 넘어간 후 이전 통합검색 페이지로 넘어갈 경우, 
기존 페이징이 유지되지 않아 이 점을 고쳐야겠다. 
멤버 페이지는 거의 다 완료를 하였고, 관리자 페이지를 오늘 설계한 내용을 바탕으로 만들어야겠다. 

## 2021-03-31~04-02 일지
1. 회원리스트 
- 검색기능 : 일반, 블락, 강퇴 회원 조회
- 조회버튼 : 최근의 1개 로그를 가져와서 내역 조회 
- 변경버튼 : 등급, 블락, 강퇴에 따라 로그 작성 
- 아이디 클릭 시, 회원 상세 페이지로 이동 
- 로그 등록/수정 : 유효성 검사 추가 

2. 회원 상세 
- 회원정보 출력 : 공개여부에 따라 회원정보 나오도록 출력 
- 로그버튼 : 로그 상세 페이지로 이동
- 목록버튼 : 리스트로 이동 
- 문화기록, 게시판 건수 및 최근 리스트 나오도록 함 

3. 탈퇴리스트 
- 아이디 클릭 시, 상세 페이지로 이동
- 상세 : 탈퇴 정보 출력 >> 목록 : 리스트로 이동 

4. 로그리스트
- 아이디별 건수 리스트 출력
- 검색기능 : 아이디 검색 
- 아이디 클릭 시, 상세 페이지로 이동 

5. 로그상세 
- 로그 히스토리 출력
- 더보기버튼 : 페이징 처리 (3개씩 가져와서 리스트에 추가, 없으면 alert창) 
- 목록버튼 : 리스트페이지로 이동

## 2021-04-03 일지 
1. 신고리스트 
- 검색기능 : 제목, 신고자, 내용, 복합검색 
- 제목 클릭 시, 신고 상세 페이지로 이동 
- 관리자는 모든 내역, 신고자는 자기가 신고한 내역이 나오도록 처리
  >> reportert(파라미터) == all, 관리자 
                       == 유저아이디, 회원

2. 신고 상세 
- 신고정보 출력 : 회원권한에 따라 신고정보 나오도록 출력(아직 회원은 작업X)
- 수정버튼 : 회원권한에 따라 신고정보 수정(아직 회원은 작업X) 
- 삭제버튼 : 신고 삭제하면서 게시글의 신고 정보도 초기화 
- 목록 : 리시트 페이지로 이동 
- 검색 : 신고된 게시글로 새 페이지로 열기 

3. 신고 팝업창 
- 문화기록, 게시판 상세 상단에 신고하기 기능 추가 
신고가 없는 경우 신고하기, 신고가 있는 경우 신고 처리중으로 >> 문구 클릭 시, 팝업창이 뜸.  
- 신고자만 수정/삭제 가능. 아닌 경우, alert창으로 신고 처리중 메시지 호출 
관리자가 처리 전일 경우만 수정/삭제 가능(처리 후 alert창으로 수정할 수 없습니다 메시지 호출)

## 2021-04-05 일지 
1. 권한 추가 
- 관리자 모든 페이지에 권한 추가(관리자만 접근하도록) 

2. 신고리스트
- 신고 등록 : 멤버(ROLE_MEMBER)만 등록하도록 수정 
- 신고 수정/삭제 : 멤버, 관리자만 수정하도록 수정 
- 신고 상세 : 멤버/관리자에 따라 수정하는 부분 다르게 수정 

3. 문화기록 
- 멤버, 관리자에 따라 리스트 보이도록 수정 >> 목록으로 올때 부분 모두 수정
멤버 : 자기꺼만(멤버 번호), 관리자 : 멤버공개, 전체공개만(0으로 조회)

4. 레프트 메뉴, 메인화면
- 멤버, 관리자에 따라 보이도록 수정 

## 2021-04-05 일지 
1. 신고리스트 유효성 검사 추가 
- 팝업창(등록/수정), 수정페이지에 화면단, 서버단 모두 유효성 검사 추가 

2. 신고리스트 탭 추가
- 오른쪽 상단에 전체/처리중/완료/미처리 탭 처리
- 탭에 따라 내용 달라지게, 탭 active 처리  
- 다른 페이지로 이동 후 다시 목록으로 돌아올 경우, requestParam으로 넘겨 상태값 유지되도록 함 

3. 멤버 로그 수정/삭제 기능 추가 
- 로그 상세에 로그 테이블에 각각 수정/삭제버튼 추가 
- 수정 : 수정페이지로 이동 >> 메모만 수정 가능 
- 삭제 : 바로 삭제 처리 

4. 나의 활동 추가 
- 멤버회원만 활동에 대한 페이지 추가 
- 로그인, 문화기록, 게시판, 댓글 수 건수 출력 
- 게시판, 댓글은 탭을 이용하여 리스트 출력 >> 더보기를 눌러 내용 더 가져오기 
  타이틀 클릭 시, 상세 화면으로 이동(문화기록은 레프트메뉴에 리스트/통계형식으로 있으므로 생략)

## 2021-04-07~08 일지 
1. 아이디/비밀번호 찾기 추가 
- 아이디찾기 : 이름, 이메일을 조회해서 아이디 결과 나오게 처리 
- 비밀번호찾기 : 아이디, 이메일을 조회해서 유효성 검사가 통과되면 이메일로 전송 
                통과되지 못하면, alert창으로 에러메시지 호출
유효성 검사 : 아이디, 이메일이 등록되는지 확인  

2. 블락, 강퇴회원 로그인 실패 처리 추가 
- userDetail 커스텀 클래스에 블락, 강퇴 회원인 경우, return null로 처리. 
블락 회원은 블락 기간이 지날 경우 satate를 업데이트 한 후, 로그인 성공 처리 

3. culture, member쪽 소스 정리 
- culture : mno, id를 둘이 번갈아가면서 조회, 수정, 삭제, 데이터 값 리턴 등을 쓰고 있어  
이 부분을 id로 통일하였고, 테이블(tb_culture)에 writer 필드 추가 
- member : myprofile의 대부분을 mno로 조회했는데, id로 통일 
느낀점 : 비밀번호 찾기에서 이메일 전송을 이용하였는데, 처음에는 구글 이메일 계정으로 시도를 했는데 
실패를 하였다. 보안 접근성을 낮췄는데 안되는 건가 생각했는데 네이버 이메일로 전송을 해보니, 
제대로 이메일 전송을 할 수 있었다. 나중에 한번 구글 이메일로 다시 한번 시도를 해봐야겠다. 
smtp을 이용하여 임시 비밀번호를 발급 이메일 전송할 수 있도록 처리하였다. 

커스텀을 이용하여 로그인 실패 서비스를 이용하려고 했는데, 이부분은 자꾸 에러가 나 일단 
userDetail 커스텀 클래스을 이용하여 블락, 강퇴회원을 로그인 못하도록 처리하였다. 
시큐리티 부분은 좀 더 공부를 하고 한번 다시 시도를 해봐야겠다. 

## 2021-04-09,11 일지 
1. 모든 유효성 검사 제대로 작동되는지 테스트 및 오류 수정
2. 에러페이지 수정 

## 2021-04-17 일지 
1. 로그인 실패 수정 
- 로그인 실패 커스텀 추가 및 에러 메시지 호출

## 2021-04-20 일지
1. 쪽지 테이블 구성 
- 테이블명 : tb_message 
- 필드 : mno(pk), sender, target, message, sdate, odate, udate, refno 

2. Persistence, Service, Controller 완료 

## 2021-04-21 일지
1. 쪽지페이지 완료 
- 탭(받은쪽지, 보낸쪽지)에 따라 리스트 출력
- 각 항목을 클릭 시, 모달창으로 상세내역 조회 
- 받은쪽지 : 답변/삭제, 보낸쪽지 : 수정/삭제
  답변 : 이미 답할 경우, 버튼 숨김 
  수정 : 쪽지를 읽었을 경우, 버튼 숨김 

2. 문화/게시판 상세페이지에 쪽지 등록 추가 
- 버튼 클릭 시, 모달창으로 등록폼 나옴 
- 멤버, 관리지만 등록 가능 

3. header에 쪽지함 추가 

## 2021-04-23 일지 
1. 쪽지 알림 기능 추가 
- WebSocket을 이용하여 유저가 접속 시, 읽지 않은 쪽지 건수 가져오도록 셋팅
- 화면단에는 footer.jsp에 sockjs-client(https://github.com/sockjs/sockjs-client)을 이용, 
  가져온 건수를 읽어 상단 쪽지아이콘에 뱃지로 표시하도록 처리 

## 2021-04-24 일지 
1. 쪽지 드랍다운 추가 
- 상단에 있는 쪽지를 클릭 시, 안읽은 쪽지 3개 표시 
- 내용 클릭 시, 상세페이지로 이동 > 답장은 모달창으로 처리 
- 답장 후에는 쪽지함 페이지로 이동    





