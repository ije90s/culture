#문화기록[culture] 카테고리 개발일지 
목적 : 완료, 오류 및 해결책 등의 세세한 내용 기입
1. 테이블 생성
- 테이블명 : culture 
- 필드 : cno(PK), cdate, kind, title, content, rank, rdate, update, mno(FK) 
         추후에 mno를 FK로 추가할 예정(member테이블 생성X) 
2. 영속 계층 CRUD 구현 
- VO : CultureVO 
- Mapper 인터페이스, Mapper XML : CultureMapper
- CRUD 구현하기 전, culture 전체 리스트를 가져오는 sql 테스트 
- CRUD 구현 후, 각각 테스트
  C(insert)부분에 cdate는 sysdate로 고정으로 테스트 >> 임의의 날짜 데이트도 잘 들어가는지 확인 완료
3. 비즈니스 계층 CRUD 구현 
- CultureService, CultureServiceImpl(CultureService Implement)
- 영속계층에 만들어낸 CRUD를 토대로 Service계층을 구현 후, 각각 테스트 
----------------------------------------------------------------------------------------
VO > Mapper > Service순 까먹지 말 것. 
급하게 말고 천천히 테스트 해보며 진행할 것. 
git에 대한 지식이 부족하여 현 프로젝트를 repository하는데 시간이 오래 걸림 >> 지식 습득 필요 
----------------------------------------------------------------------------------------
4. 웹 계층 CRUD 구현 
- CultureController에 아래와 같은 표로 구현 
|구분|URL|Method|Parameter|From|URL이동|
|---|--------|---|---|--------|---|
|목록|/culture/list|get||||
|상세|/culture/get|get|cno|||
|등록|/culture/register|post|모든항목|입력화면필요|O|
|수정|/culture/modify|post|모든항목|입력화면필요|O|
|삭제|/culture/remove|post|cno|입력화면필요|O|
- MockMVC로 각각 화면 테스트 
5. 화면단 처리 
- [부트스트랩을 이용] : https://startbootstrap.com/theme/sb-admin-2
- 나의 기록 목록 화면 완료, 현재 등록폼 작성중 
----------------------------------------------------------------------------------------
오류 : java.lang.NoClassDefFoundError: javax/servlet/SessionCookieConfig
Junit으로 테스트 케이스를 만들어 세션에 어떤 작업을 할 때, MockHttpSession 객체를 생성하게 되는데, 서블릿 버전 3.1 이하에서는 SessionCookieConfig 클래스를 찾지 못하는 오류가 발생  
해결책 : 서블릿 jar 파일을 3.1 버전으로 업데이트 해 주면 해결된다.
오류 : java.lang.IllegalStateException: Failed to load ApplicationContext
Caused by: java.io.FileNotFoundException: src\main\webapp\WEB-INF\spring\servlet-context.xml (지정된 파일을 찾을 수 없습니다)
해결책 : 파일 경로가 제대로 되는지 한번 더 체크 

느낀점 : 두개의 오류가 발생한 이유는 테스트를 급하게 하느라 발생하는 것으로, 한번 더 체크하는 습관을 들이도록 하자
----------------------------------------------------------------------------------------
- 상세, 등록, 수정, 삭제 완료 
- 등록/수정/삭제 처리 후, 모달창 띄우기 완료 
----------------------------------------------------------------------------------------
오류 : 뒤로가기 문제 
등록 처리 후, 다시 뒤로 갔다가 되돌아오면 모달창이 띄워지는 문제가 발생
해결책 : history API의 replaceState 이용하여 초기화해준 뒤, 모달창 나오지 않게 막음  
----------------------------------------------------------------------------------------
- 페이징처리완료, 파일첨부 진행 중 
- 페이징 처리 : 한페이지당 10개씩 보이도록 처리 
VO : Criteria(페이지번호, 개수), PageVO(시작,페이지,pre,next 만듬) >> Model에 전달 
상세/수정 > 목록으로 돌아올 때, 그 페이지 목록으로 돌아오도록 함(페이지번호, 개수를 hidden으로 전달)
- 파일 첨부 : 서블릿3.0 API, ajax 이용 
ajax 처리 : 파일 업로드, 삭제, 파일 보기  
----------------------------------------------------------------------------------------
오류 : 파일첨부 재첨부 문제 
파일을 업로드하고 나서 재첨부를 할 경우, 첨부가 되지 않는 오류가 발생. 
아직 해결은 못했으나, 아래와 같은 방법으로 오류를 해결할까 구상중
첨부된 파일을 그대로 둔 채, 파일을 첨부할 수 있는 방법 필요(각 파일의 넘버링 필요)

느낀점 : 페이징, 파일첨부는 회사에서 해왔던 방식은 비슷하나, 용어나 문법에 다소 약하는 걸 느꼈다. 
다른 페이지쪽을 할때, 다시 한번 작업을 하면서 감각을 기르자.   
----------------------------------------------------------------------------------------
6. 파일첨부
- 테이블 생성 및 등록화면 화면 수정 완료 
- 테이블 : tb_attach_group
  필드   : gno(PK), rdate, mno, cno(FK), bno
           mno, bno는 나중에 외래키로 등록할 예정 
- 테이블 : tb_attach 
  필드   : uuid(PK), fileName, fileType, gno(FK), path
- 두 테이블에 있는 값을 조회/등록/삭제할 수 있도록 쿼리 테스트 완료 
- 파일 첨부 등록/조회/수정/삭제 완료(3일 정도 소요)
삭제는 게시글을 아예 삭제하는 경우, 첨부파일을 삭제하는 경우를 나눠서 삭제처리함 
----------------------------------------------------------------------------------------
새로 배운 내용 : mybatis에서 조인된 테이블들을 select, insert 하는 부분을 배웠다. 
테이블 조회 - resultMap을 이용하여 각 VO를 선언 후, 부모VO에다가 collection으로 연결하여 테이블 조회
insert all - insert all은 한꺼번에 테이블을 동시에 insert하는 것. 
mybatis에서는 insert all을 하기 위해서는 paramterType은 List로, begin = "insert all", end="select * from dual"을 명시.
select * from dual을 명시하지 않으면, 오류 발생(오라클 sql문법 자체에서 insert all 뒤에 꼭 서브쿼리가 붙음)
delete문 같은 경우에는 두 개의 다른 테이블을 동시에 삭제하는 방법을 찾아봤으나, 알 수가 없어 따로 delete문을 만듬
tb_attach(FK) > tb_attach_group 순으로 삭제 처리하도록 함  

느낀점 : 두개의 테이블이 1:N의 관계이기 때문에 영속계층부터 생각하면서 진행하다보니 시간을 많이 잡아먹었다. 
특히 등록화면에서 파일첨부 후, <form>태그 안에 첨부된 파일들을 <input>값으로 추가하는데 시간이 오래 걸렸으나, 
한개의 테이블이 아닌 연결된 테이블을 이용하여 CRUD 구현함으로써 새로운 문법을 알아가는 건 뿌듯했다.  
동시에 mybatis, sql문, 자바스크립트(list)를 완벽하게 알지 못한다는 부족함이 보여 보완해야겠다.   

오류 : 모달창 닫기버튼 오류 
첨부된 이미지를 클릭 시, 모달창으로 원본 이미지가 보이는데 X 버튼은 제대로 작동하나, close 버튼을 누르면 리스트로 넘어가는 
오류가 발생  
----------------------------------------------------------------------------------------
7. 통계화면 
- 기존 CultureVO에서 day, sum 추가, Criteria에서 sDate, eDate 추가 
day : 날짜, sum : 건수, sdate : 시작일, edate : 종료일 
월별,통계 : 월의 시작일~막일, 연별 : 1월 1일 ~ 당월 막일 
날짜는 Date 대신 String으로 처리. 
- 영속~서비스계층 완료, 화면단 작업중
----------------------------------------------------------------------------------------
새로 배운 내용 : TO_CHAR, TO_DATE 형변환 함수 
TO_CHAR : 날짜 또는 숫자를 문자열로 변환하는 함수 
TO_DATE : 날짜형 데이터로 변환하는 함수

느낀점 : 쿼리의 조건절을 Date객체를 넘겨서 데이터를 출력하려고 했는데, 원하는 대로 나오지 않아 
String으로 전환을 하였다. 일단 내용은 나오는데 성공했으니, 화면단까지 마무리 짓고나서 구글링을 통해 더 나은 방법있는지 
찾아봐야겠다. 
----------------------------------------------------------------------------------------
- 화면단 처리 완료 
일별, 연별, 그래프별로 가져올 때, 쿼리 부분이 달라 따로 지정을 하고, ajax으로 탭 항목 별로 가져오도록 처리 
- 월별의 일을 더블 클릭 시, 요약화면 모달창 띄움
  연별 더블 클릭 시, 월별 화면으로 이동  
  그래프 더블 클릭 시, 요약화면 모달창 띄움 
- 날짜 검색은 datepicker를 이용하고, 년-월만 보이도록 처리 
----------------------------------------------------------------------------------------
새로 배운 내용 : 비율 계산 
비율계산을 하기 위해서는 대표값, 합계을 가지고 ratido 처리를 한다 
ROUND(RATIO_TO_REPORT(count(*)) over(PARTITION BY GROUPING_ID(kind)) * 100,0) as ratio

오류 : 그래프쪽 이전 데이터가 나오는 문제 
날짜를 검색해서 새로운 내용을 가져오면 이전 데이터 값이 나오는 문제가 발생 
해결책 : 이전 컨버스를 삭제하고 다시 컨버스를 새로 생성하는 걸로 처리하여 해결 

느낀점 : 통계화면은 내용을 보여주는 페이지이기 때문에 간단하게 끝날줄 알았는데 
각 탭별로 출력화면이 달라(달력, 표, 차트) 어떻게 비슷하게 통일을 해야 하나 고민이 많았는데, 
생각한대로 구현되어 뿌듯하고, 나중에 등록/수정/삭제 기능을 추가해서 보완해야겠다. 
----------------------------------------------------------------------------------------