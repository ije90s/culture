<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.ije.mapper.MemberMapper">
	<resultMap type="com.ije.domain.MemberVO" id="memberMap">
		<id property="mno" column="mno" />
		<result property="mno" column="mno"/>
		<result property="id" column="id"/>
		<result property="pw" column="pw"/>
		<result property="name" column="name"/>
		<result property="phone" column="phone"/>
		<result property="email" column="email"/>
		<result property="favorites" column="favorites"/>
		<result property="rdate" column="rdate"/>
		<result property="udate" column="udate"/>
		<collection property="authList" resultMap="autoMap"></collection>
	</resultMap>
	
	<resultMap type="com.ije.domain.AuthVO" id="autoMap">
		<result property="auth" column="auth"/>
		<result property="mno" column="mno"/>
	</resultMap>
	
	<select id="read" resultMap="memberMap">
	select a.mno, id, pw, name, phone, email, favorites, rdate, udate, auth 
	from tb_member a left outer join tb_member_auth b on a.mno=b.mno 
	where id=#{id}
	</select>
	
	<insert id="insert" parameterType="java.util.List">
		<foreach collection="list" item="item" open="INSERT ALL" close="select * from dual" separator=" " >
		Into tb_member(mno, id, pw, name, phone, email, favorites)
		Values (seq_member.nextval, #{item.id}, #{item.pw}, #{item.name}, #{item.phone}, #{item.email}, #{item.favorites})
		Into tb_member_auth(mno) Values(seq_member.nextval)
		</foreach>
	</insert>
	
	<update id="update">
	update tb_member 
	set name=#{name}, phone=#{phone}, email=#{email}, favorites=#{favorites}, udate=sysdate
	where mno=#{mno}
	</update>
	
	<update id="updatePw">
	update tb_member
	set pw=#{pw}, udate=sysdate 
	where mno=#{mno}
	</update>
	
	<delete id="delete">
	delete tb_member where mno=#{mno}
	</delete>
	
	<insert id="insert2">
	insert into tb_unjoin(reason, memo, id)
	values (#{reason}, #{memo}, #{id})
	</insert>
</mapper>